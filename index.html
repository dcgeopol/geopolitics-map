<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GeoTracker</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  <!-- Leaflet.draw CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css">

  <style>
    html, body { height: 100%; margin: 0; font-family: sans-serif; }

    :root { --panelW: 380px; }

    /* MAP ALWAYS VISIBLE (left side) */
    #map{
      position: fixed;
      top: 0;
      left: 0;
      right: var(--panelW);
      bottom: 0;
      background: #ddd; /* makes it obvious if tiles fail */
    }

    /* RIGHT PANEL */
    #intelPanel{
      position: fixed;
      top: 0;
      right: 0;
      width: var(--panelW);
      height: 100vh;
      overflow: auto;
      z-index: 700;
      background: rgba(255,255,255,0.96);
      border-left: 1px solid rgba(0,0,0,0.10);
      box-shadow: -8px 0 24px rgba(0,0,0,0.08);
      padding: 12px;
      box-sizing: border-box;
    }

    /* Date picker */
    #date {
      position: fixed;
      top: 10px;
      left: 120px;
      z-index: 950;
      padding: 4px;
      font-size: 14px;
      background: rgba(255,255,255,0.95);
      border: 1px solid rgba(0,0,0,0.15);
      border-radius: 10px;
    }

    /* Buttons row */
    #toggleStyle, #undoBtn, #redoBtn, #freeDrawBtn, #moveBtn{
      position: fixed;
      top: 50px;
      z-index: 950;
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      background: rgba(255,255,255,0.95);
      cursor: pointer;
      font-weight: 700;
    }
    #toggleStyle{ left: 260px; }
    #undoBtn{ left: 330px; }
    #redoBtn{ left: 400px; }
    #freeDrawBtn{ left: 470px; }
    #moveBtn{ left: 600px; }

    /* Leaflet controls above panel */
    .leaflet-top, .leaflet-bottom { z-index: 1000 !important; }

    /* Style panel (won't overlap right panel) */
    #stylePanel{
      position: fixed;
      top: 95px;
      left: 260px;
      z-index: 980;
      background: rgba(255,255,255,0.95);
      padding: 10px;
      border-radius: 12px;
      display: none;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      font-size: 12px;
      max-width: calc(100vw - var(--panelW) - 30px);
      overflow: auto;
      border: 1px solid rgba(0,0,0,0.10);
      box-shadow: 0 8px 24px rgba(0,0,0,0.10);
    }
    #stylePanel label{ display:flex; gap:6px; align-items:center; }
    #stylePanel input[type="number"]{ width:70px; }

    /* Panel UI */
    .intelHeader{ display:flex; flex-direction:column; gap:10px; margin-bottom:10px; }
    .intelName{ font-weight:900; font-size:18px; }
    .intelSub{ font-size:12px; opacity:0.7; margin-top:2px; }
    .intelTabs{ display:flex; gap:8px; }
    .tabBtn{
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.9);
      cursor: pointer;
      font-size: 12px;
      font-weight: 800;
    }
    .tabActive{ background: rgba(0,0,0,0.06); }

    .card{
      background: rgba(255,255,255,0.9);
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px;
      padding: 10px;
      margin-bottom: 10px;
    }
    .cardTitle{ font-weight: 900; font-size: 12px; letter-spacing: 0.04em; opacity: 0.8; margin-bottom: 8px; }
    .field{ display:block; margin-bottom: 8px; }
    .fieldLabel{ font-size: 12px; font-weight: 800; opacity: 0.75; margin-bottom: 4px; }
    .field input, .field select, .field textarea{
      width: 100%;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.12);
      font-size: 13px;
      box-sizing: border-box;
    }
    .row2{ display:grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .primaryBtn{
      width: 100%;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.12);
      cursor: pointer;
      font-weight: 900;
      background: rgba(0,0,0,0.06);
    }
    .hint{ font-size: 12px; opacity: 0.65; margin-top: 8px; }
    .feedTop{ display:flex; align-items:flex-start; justify-content:space-between; gap:8px; margin-bottom:8px; }
    .feedFilters{ display:flex; gap:8px; align-items:center; flex-wrap: wrap; justify-content:flex-end; }
    #filterType{ width: 140px; }
    #filterCountry, #filterProvince, #filterCity { width: 140px; }
    #searchBox{ flex: 1; min-width: 160px; }
    .feedList{ display:flex; flex-direction:column; gap:8px; }
    .emptyState{ font-size: 12px; opacity: 0.65; padding: 10px; border-radius: 10px; background: rgba(0,0,0,0.03); }
    /* =========================
   MOBILE: intel panel becomes a slide-in drawer
   ========================= */
#panelToggle { display:none; }
#panelBackdrop { display:none; }

@media (max-width: 900px){
  :root { --panelW: 0px; }

  /* Map gets full screen */
  #map { right: 0; }

  /* Intel panel is off-canvas by default */
  #intelPanel{
    width: min(420px, 92vw);
    transform: translateX(100%);
    transition: transform 160ms ease;
    z-index: 1200;
  }
  #intelPanel.open{
    transform: translateX(0);
  }

  /* Backdrop behind the drawer */
  #panelBackdrop{
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.25);
    z-index: 1100;
  }
  #panelBackdrop.show{ display:block; }

  /* Mobile toggle button (top-right) */
  #panelToggle{
    display: block;
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1300;
    padding: 8px 12px;
    border-radius: 12px;
    border: 1px solid rgba(0,0,0,0.15);
    background: rgba(255,255,255,0.95);
    font-weight: 900;
  }

  /* Style panel should never fight the drawer on mobile */
  #stylePanel{
    left: 10px !important;
    max-width: calc(100vw - 20px) !important;
  }
}

  </style>
</head>

<body>
  <div id="map"></div>

  <input type="date" id="date" />

  <button id="toggleStyle">Style</button>
  <button id="undoBtn">Undo</button>
  <button id="redoBtn">Redo</button>
  <button id="freeDrawBtn">Free Draw</button>
  <button id="moveBtn">Move</button>

  <div id="stylePanel">
    <label>Stroke color <input id="strokeColor" type="color" value="#ff0000"></label>
    <label>Stroke width <input id="strokeWidth" type="number" min="1" max="20" value="4"></label>
    <label>Stroke opacity <input id="strokeOpacity" type="number" min="0" max="1" step="0.05" value="0.9"></label>

    <label><input id="useFill" type="checkbox" checked> Fill</label>
    <label>Fill color <input id="fillColor" type="color" value="#ff0000"></label>
    <label>Fill opacity <input id="fillOpacity" type="number" min="0" max="1" step="0.05" value="0.25"></label>
  </div>

  <div id="intelPanel">
    <div class="intelHeader">
      <div>
        <div class="intelName">GeoTracker</div>
        <div class="intelSub">Global Intelligence Monitoring System</div>
      </div>
      <div class="intelTabs">
        <button id="tabFeed" class="tabBtn tabActive" type="button">Feed</button>
        <button id="tabNotes" class="tabBtn" type="button">Notes</button>
      </div>
    </div>

    <div id="feedTab" class="tabBody">
      <div class="card">
        <div class="cardTitle">NEW ENTRY</div>

        <label class="field">
          <div class="fieldLabel">Title</div>
          <input id="entryTitle" placeholder="Short headline..." />
        </label>

        <div class="row2">
          <label class="field">
            <div class="fieldLabel">Date</div>
            <input id="entryDate" type="date" />
          </label>

          <label class="field">
            <div class="fieldLabel">Category</div>
            <select id="entryType">
              <option value="Event">Event</option>
              <option value="Military">Military</option>
              <option value="Tech">Tech</option>
              <option value="Resources">Resources</option>
              <option value="SupplyChain">Supply Chain</option>
              <option value="Politics">Politics</option>
              <option value="Other">Other</option>
            </select>
          </label>
        </div>

        <div class="row2">
          <label class="field">
            <div class="fieldLabel">Country</div>
            <input id="entryCountry" placeholder="United States, China..." />
          </label>

          <label class="field">
            <div class="fieldLabel">Province / State</div>
            <input id="entryProvince" placeholder="California, Guangdong..." />
          </label>
        </div>

        <label class="field">
          <div class="fieldLabel">City</div>
          <input id="entryCity" placeholder="San Diego, Shenzhen..." />
        </label>

        <label class="field">
          <div class="fieldLabel">Tags (comma separated)</div>
          <input id="entryTags" placeholder="sanctions, shipbuilding, drones..." />
        </label>

        <label class="field">
          <div class="fieldLabel">Intelligence Data</div>
          <textarea id="entryText" rows="5" placeholder="Enter briefing details..."></textarea>
        </label>

        <button id="pickPointBtn" class="primaryBtn" type="button">Pick Map Point</button>
        <div id="pickedPointStatus" class="hint">No point selected.</div>

        <button id="addToFeedBtn" class="primaryBtn" type="button">+ Add to Feed</button>
      </div>

      <div class="card">
        <div class="feedTop">
          <div class="cardTitle">FEED</div>
          <div class="feedFilters">
            <select id="filterType">
              <option value="ALL">All Categories</option>
              <option value="Event">Event</option>
              <option value="Military">Military</option>
              <option value="Tech">Tech</option>
              <option value="Resources">Resources</option>
              <option value="SupplyChain">Supply Chain</option>
              <option value="Politics">Politics</option>
              <option value="Other">Other</option>
            </select>

            <input id="filterCountry" placeholder="Country filter..." />
            <input id="filterProvince" placeholder="Province filter..." />
            <input id="filterCity" placeholder="City filter..." />
            <input id="searchBox" placeholder='Search keywords (e.g. "microchip")...' />
          </div>
        </div>

        <div id="feedList" class="feedList">
          <div class="emptyState">No entries yet.</div>
        </div>
      </div>
    </div>

    <div id="notesTab" class="tabBody" style="display:none;">
      <div class="card">
        <div class="cardTitle">NOTES</div>
        <div class="hint">Click a map object → notes show here.</div>
        <div id="notesBody" class="emptyState">No object selected.</div>
      </div>
    </div>
  </div>

  <!-- ✅ Correct load order (ALL defer): Leaflet -> Leaflet.draw -> app.js -->
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script defer src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script defer src="./app.js?v=6"></script>

  <!-- Tabs + default date -->
  <script defer>
    (function () {
      const today = new Date().toISOString().slice(0,10);
      const entryDate = document.getElementById('entryDate');
      if (entryDate && !entryDate.value) entryDate.value = today;

      const tabFeed = document.getElementById('tabFeed');
      const tabNotes = document.getElementById('tabNotes');
      const feedTab = document.getElementById('feedTab');
      const notesTab = document.getElementById('notesTab');

      function setTab(which) {
        const feedOn = which === 'feed';
        if (feedTab) feedTab.style.display = feedOn ? '' : 'none';
        if (notesTab) notesTab.style.display = feedOn ? 'none' : '';
        if (tabFeed) tabFeed.classList.toggle('tabActive', feedOn);
        if (tabNotes) tabNotes.classList.toggle('tabActive', !feedOn);
      }

      if (tabFeed) tabFeed.addEventListener('click', () => setTab('feed'));
      if (tabNotes) tabNotes.addEventListener('click', () => setTab('notes'));
    })();
  </script>
    <!-- Mobile drawer toggle + backdrop -->
  <button id="panelToggle" type="button" aria-label="Toggle intel panel">Intel</button>
  <div id="panelBackdrop"></div>

</body>
</html>
