<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Geopolitical Map</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Leaflet Draw -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.draw@1.0.4/dist/leaflet.draw.css" />

  <style>
    body { margin: 0; font-family: sans-serif; }
    #map { height: 100vh; }

    /* Date picker */
    #date {
      position: absolute;
      top: 10px;
      left: 120px;
      z-index: 500;
      padding: 4px;
      font-size: 14px;
    }

    /* Buttons */
    #toggleStyle, #undoBtn, #redoBtn, #freeDrawBtn, #moveBtn{
      position:absolute;
      top:50px;
      z-index:700;
      padding:4px 8px;
      border-radius:10px;
      border:1px solid #ccc;
      background: rgba(255,255,255,0.95);
      cursor:pointer;
    }

    #toggleStyle{ left: 260px; }
    #undoBtn{     left: 330px; }
    #redoBtn{     left: 400px; }
    #freeDrawBtn{ left: 470px; }
    #moveBtn{     left: 580px; }

    /* Keep Leaflet controls (zoom + draw toolbar) above other elements */
    .leaflet-top.leaflet-left { z-index: 900; }

    /* Style panel: top-right + starts hidden (toggle with Style button) */
    #stylePanel{
      position:absolute;
      top:10px;
      right:10px;
      left:auto;
      z-index:800;
      background: rgba(255,255,255,0.95);
      padding:8px;
      border-radius:10px;
      display:none;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      font-size:12px;
      max-width: min(720px, calc(100vw - 20px));
    }
    #stylePanel label{ display:flex; gap:6px; align-items:center; }
    #stylePanel input[type="number"]{ width:70px; }

    /* ==========================
       RIGHT PANEL: Intel + Notes
       ========================== */
    #intelPanel{
      position: absolute;
      top: 10px;
      right: 10px;
      left: auto;
      width: 360px;
      max-height: calc(100vh - 20px);
      overflow: auto;
      z-index: 850; /* above stylePanel */
      background: rgba(255,255,255,0.96);
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      padding: 12px;
    }

    .intelHeader{ display:flex; flex-direction:column; gap:10px; margin-bottom:10px; }
    .intelName{ font-weight:800; font-size:18px; }
    .intelSub{ font-size:12px; opacity:0.7; margin-top:2px; }

    .intelTabs{ display:flex; gap:8px; }
    .tabBtn{
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.9);
      cursor: pointer;
      font-size: 12px;
      font-weight: 700;
    }
    .tabActive{ background: rgba(0,0,0,0.06); }

    .card{
      background: rgba(255,255,255,0.9);
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px;
      padding: 10px;
      margin-bottom: 10px;
    }

    .cardTitle{ font-weight: 900; font-size: 12px; letter-spacing: 0.04em; opacity: 0.8; margin-bottom: 8px; }

    .field{ display:block; margin-bottom: 8px; }
    .fieldLabel{ font-size: 12px; font-weight: 700; opacity: 0.75; margin-bottom: 4px; }
    .field input, .field select, .field textarea{
      width: 100%;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.12);
      font-size: 13px;
      box-sizing: border-box;
    }

    .row2{ display:grid; grid-template-columns: 1fr 1fr; gap: 8px; }

    .primaryBtn{
      width: 100%;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.12);
      cursor: pointer;
      font-weight: 900;
      background: rgba(0,0,0,0.06);
    }

    .hint{ font-size: 12px; opacity: 0.65; margin-top: 8px; }
    .feedTop{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px; }
    .feedFilters{ display:flex; gap:8px; align-items:center; }
    #filterType{ width: 120px; }
    #searchBox{ flex:1; min-width: 120px; }

    .feedList{ display:flex; flex-direction:column; gap:8px; }
    .emptyState{ font-size: 12px; opacity: 0.65; padding: 10px; border-radius: 10px; background: rgba(0,0,0,0.03); }
  </style>
</head>

<body>
  <input type="date" id="date" />

  <button id="toggleStyle">Style</button>
  <button id="undoBtn">Undo</button>
  <button id="redoBtn">Redo</button>
  <button id="freeDrawBtn">Free Draw</button>
  <button id="moveBtn">Move</button>

  <div id="stylePanel">
    <label>Stroke color <input id="strokeColor" type="color" value="#ff0000"></label>
    <label>Stroke width <input id="strokeWidth" type="number" min="1" max="20" value="4"></label>
    <label>Stroke opacity <input id="strokeOpacity" type="number" min="0" max="1" step="0.05" value="0.9"></label>

    <label><input id="useFill" type="checkbox" checked> Fill</label>
    <label>Fill color <input id="fillColor" type="color" value="#ff0000"></label>
    <label>Fill opacity <input id="fillOpacity" type="number" min="0" max="1" step="0.05" value="0.25"></label>
  </div>

  <!-- RIGHT PANEL: Intel + Notes -->
  <div id="intelPanel">
    <div class="intelHeader">
      <div class="intelTitle">
        <div class="intelName">GeoTracker</div>
        <div class="intelSub">Global Intelligence Monitoring System</div>
      </div>

      <div class="intelTabs">
        <button id="tabFeed" class="tabBtn tabActive">Feed</button>
        <button id="tabNotes" class="tabBtn">Notes</button>
      </div>
    </div>

    <!-- FEED TAB -->
    <div id="feedTab" class="tabBody">
      <div class="card">
        <div class="cardTitle">NEW ENTRY</div>

        <div class="row2">
          <label class="field">
            <div class="fieldLabel">Date</div>
            <input id="entryDate" type="date" />
          </label>

          <label class="field">
            <div class="fieldLabel">Type</div>
            <select id="entryType">
              <option value="Event">Event</option>
              <option value="Military">Military</option>
              <option value="Tech">Tech</option>
              <option value="Resources">Resources</option>
              <option value="SupplyChain">Supply Chain</option>
              <option value="Politics">Politics</option>
              <option value="Other">Other</option>
            </select>
          </label>
        </div>

        <label class="field">
          <div class="fieldLabel">Country (text for now)</div>
          <input id="entryCountry" placeholder="United States, China, Russia..." />
        </label>

        <label class="field">
          <div class="fieldLabel">Tags (comma separated)</div>
          <input id="entryTags" placeholder="sanctions, shipbuilding, drones..." />
        </label>

        <label class="field">
          <div class="fieldLabel">Intelligence Data</div>
          <textarea id="entryText" rows="5" placeholder="Enter briefing details..."></textarea>
        </label>

        <button id="addToFeedBtn" class="primaryBtn">+ Add to Feed</button>
        <div class="hint">Later: this will optionally link to the selected map shape.</div>
      </div>

      <div class="card">
        <div class="feedTop">
          <div class="cardTitle">FEED</div>

          <div class="feedFilters">
            <select id="filterType">
              <option value="ALL">All Types</option>
              <option value="Event">Event</option>
              <option value="Military">Military</option>
              <option value="Tech">Tech</option>
              <option value="Resources">Resources</option>
              <option value="SupplyChain">Supply Chain</option>
              <option value="Politics">Politics</option>
              <option value="Other">Other</option>
            </select>

            <input id="searchBox" placeholder="Search..." />
          </div>
        </div>

        <div id="feedList" class="feedList">
          <div class="emptyState">No entries yet.</div>
        </div>
      </div>
    </div>

    <!-- NOTES TAB -->
    <div id="notesTab" class="tabBody" style="display:none;">
      <div class="card">
        <div class="cardTitle">NOTES</div>
        <div class="hint">
          Click a shape/marker on the map â†’ notes will show here (next step).
        </div>

        <div id="notesBody" class="emptyState">
          No object selected.
        </div>
      </div>
    </div>
  </div>

  <div id="map"></div>

<!-- Scripts: Leaflet FIRST -->
<script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Path drag plugin -->
<script defer src="https://cdn.jsdelivr.net/npm/leaflet-path-drag@0.0.14/dist/L.Path.Drag.js"></script>

<!-- Leaflet Draw -->
<script defer src="https://unpkg.com/leaflet.draw@1.0.4/dist/leaflet.draw.js"></script>

<!-- Freehand plugin -->
<script defer src="https://unpkg.com/leaflet-freehandshapes@1.0.0/dist/leaflet-freehandshapes.min.js"></script>

<!-- Your app (defer!!) -->
<script defer src="./app.js?v=18"></script>

<!-- Tiny UI wiring (defer!!) -->
<script defer>
  (function () {
    const today = new Date().toISOString().slice(0,10);
    const entryDate = document.getElementById('entryDate');
    if (entryDate && !entryDate.value) entryDate.value = today;

    const tabFeed = document.getElementById('tabFeed');
    const tabNotes = document.getElementById('tabNotes');
    const feedTab = document.getElementById('feedTab');
    const notesTab = document.getElementById('notesTab');

    function setTab(which) {
      const feedOn = which === 'feed';
      if (feedTab) feedTab.style.display = feedOn ? '' : 'none';
      if (notesTab) notesTab.style.display = feedOn ? 'none' : '';
      if (tabFeed) tabFeed.classList.toggle('tabActive', feedOn);
      if (tabNotes) tabNotes.classList.toggle('tabActive', !feedOn);
    }

    if (tabFeed) tabFeed.addEventListener('click', () => setTab('feed'));
    if (tabNotes) tabNotes.addEventListener('click', () => setTab('notes'));
  })();
</script>

</body>
</html>
